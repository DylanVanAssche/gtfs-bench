@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix ex: <http://example.com/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix rev: <http://purl.org/stuff/rev#> .
@prefix gtfs: <http://vocab.gtfs.org/terms#> .
@prefix geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix schema: <http://schema.org/> .
@prefix dct: <http://purl.org/dc/terms/> .



<TriplesMapStopTimes>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:sqlQuery """

        SELECT STOP_TIMES.*, (CASE PICKUP_TYPE
            WHEN 0 THEN 'Regular'
            WHEN 1 THEN 'notAvailable'
            WHEN 2 THEN 'MustPhone'
            WHEN 3 THEN 'MustCoordinateWithDriver'
        END) PICKUP, (CASE DROP_OFF_TYPE
            WHEN 0 THEN 'Regular'
            WHEN 1 THEN 'notAvailable'
            WHEN 2 THEN 'MustPhone'
            WHEN 3 THEN 'MustCoordinateWithDriver'
        END) DROPOFF FROM STOP_TIMES

        """ 
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/stoptimes/{TRIP_ID}-{STOP_ID}-{ARRIVAL_TIME}";
    rr:termType rr:IRI;
    rr:class gtfs:StopTime;
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:trip;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapTrip>;
      rr:joinCondition [
        rr:child "TRIP_ID";
        rr:parent "TRIP_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:stop;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapStop>;
      rr:joinCondition [
        rr:child "STOP_ID";
        rr:parent "STOP_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:arrivalTime;
    rr:objectMap [
      rr:datatype xsd:duration;
      rr:column "ARRIVAL_TIME";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:departureTime;
    rr:objectMap [
      rr:datatype xsd:duration;
      rr:column "DEPARTURE_TIME";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:stopSequence;
    rr:objectMap [
      rr:datatype xsd:nonNegativeInteger;
      rr:column "STOP_SEQUENCE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:headsign;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "STOP_HEADSIGN";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:pickupType;
    rr:objectMap [
      rr:template "http://vocab.gtfs.org/terms#{PICKUP}";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:dropOffType;
    rr:objectMap [
      rr:template "http://vocab.gtfs.org/terms#{DROPOFF}";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:distanceTraveled;
    rr:objectMap [
      rr:datatype xsd:decimal;
      rr:column "SHAPE_DIST_TRAVELED";
    ];
  ];
.  


<TriplesMapTrip>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "TRIPS"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/trips/{TRIP_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:Trip;
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:route;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapRoute>;
      rr:joinCondition [
        rr:child "ROUTE_ID";
        rr:parent "ROUTE_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:service;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapService>;
      rr:joinCondition [
        rr:child "SERVICE_ID";
        rr:parent "SERVICE_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:shape;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapShape>;
      rr:joinCondition [
        rr:child "SHAPE_ID";
        rr:parent "SHAPE_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:headsign;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "TRIP_HEADSIGN"
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:shortName;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "TRIP_SHORT_NAME"
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:direction;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "DIRECTION_ID"
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:block;
    rr:objectMap [
      rr:datatype xsd:nonNegativeInteger;
      rr:column "BLOCK_ID"
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:wheelchairAccessible;
    rr:objectMap [
      rr:datatype gtfs:WheelchairBoardingStatus;
      rr:column "WHEELCHAIR_ACCESSIBLE"
    ]
  ];

.

<TriplesMapRoute>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:sqlQuery """
        SELECT ROUTES.*, (CASE ROUTE_TYPE
            WHEN 0 THEN 'LightRail'
            WHEN 1 THEN 'Subway'
            WHEN 2 THEN 'Rail'
            WHEN 3 THEN 'Bus'
            WHEN 4 THEN 'Ferry'
            WHEN 5 THEN 'CableCar'
            WHEN 6 THEN 'Gondola'
            WHEN 7 THEN 'Funicular'
        END) ROUTETYPE FROM ROUTES

        """ 
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/routes/{ROUTE_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:Route;
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:agency;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapAgency>;
      rr:joinCondition [
        rr:child "AGENCY_ID";
        rr:parent "AGENCY_ID";
      ]
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:shortName;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "ROUTE_SHORT_NAME";
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:longName;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "ROUTE_LONG_NAME";
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate dct:description;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "ROUTE_DESC";
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:routeType;
    rr:objectMap [
      rr:template "http://vocab.gtfs.org/terms#{ROUTETYPE}";
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:routeUrl;
    rr:objectMap [
      rr:datatype foaf:Document;
      rr:column "ROUTE_URL";
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:color;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "ROUTE_COLOR";
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:textColor;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "ROUTE_TEXT_COLOR";
    ]
  ];
.


<TriplesMapAgency>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "AGENCY"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/agency/{AGENCY_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:Agency;
  ];

  rr:predicateObjectMap[
    rr:predicate foaf:page;
    rr:objectMap [
      rr:datatype foaf:Document;
      rr:column "AGENCY_URL";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate foaf:name;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "AGENCY_NAME";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:timeZone;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "AGENCY_TIMEZONE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate dct:language;
    rr:objectMap [
      rr:datatype dct:LiguisticSystem;
      rr:column "AGENCY_LANG";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate foaf:phone;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "AGENCY_PHONE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:fareUrl;
    rr:objectMap [
      rr:termType rr:IRI;
      rr:column "AGENCY_FARE_URL";
    ];
  ];

.

<TriplesMapStop>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "STOPS"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/stops/{STOP_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:Stop;
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:code;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "STOP_CODE";
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate foaf:name;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "STOP_NAME";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate dct:description;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "STOP_DESC";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate geo:lat;
    rr:objectMap [
      rr:datatype xsd:decimal;
      rr:column "STOP_LAT";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate geo:long;
    rr:objectMap [
      rr:datatype xsd:decimal;
      rr:column "STOP_LON";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:zone;
    rr:objectMap [
      rr:datatype gtfs:Zone;
      rr:column "ZONE_ID";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate foaf:page;
    rr:objectMap [
      rr:datatype foaf:Document;
      rr:column "STOP_URL";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:locationType;
    rr:objectMap [
      rr:datatype xsd:integer;
      rr:column "LOCATION_TYPE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:parentStation;
    rr:objectMap [
      rr:datatype gtfs:Stop;
      rr:column "PARENT_STATION";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:timeZone;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "STOP_TIMEZONE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:weelchairAccessible;
    rr:objectMap [
      rr:datatype gtfs:WheelchairBoardingStatus;
      rr:column "WHEELCHAIR_BOARDING";
    ];
  ];
.


<TriplesMapServiceDates>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "CALENDAR_DATES"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/servicedates/{SERVICE_ID}-{DATE}";
    rr:termType rr:IRI;
    rr:class gtfs:ServiceDates;
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:service;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapService>;
      rr:joinCondition [
        rr:child "SERVICE_ID";
        rr:parent "SERVICE_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate dct:date;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "DATE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:dateAddition;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "EXCEPTION_TYPE";
    ];
  ];
. 


<TriplesMapFare>
  # a rr:TriplesMap;

  rr:logicalTable [
    rr:sqlQuery """
        SELECT FARE_ATTRIBUTES.*, (CASE PAYMENT_METHOD
            WHEN 0 THEN 'OnBoard'
            WHEN 1 THEN 'BeforeBoarding'
        END) PAY, (CASE TRANSFERS
            WHEN 0 THEN 'NoTransfersAllowed'
            WHEN 1 THEN 'OneTransfersAllowed'
            WHEN 2 THEN 'TwoTransfersAllowed'
            ELSE 'UnlimitedTransfersAllowed'
        END) TRANS FROM FARE_ATTRIBUTES

        """ 
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/fare/{FARE_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:Fare;
  ];


  rr:predicateObjectMap[
    rr:predicate schema:price;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "PRICE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate schema:priceCurrency;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "CURRENCY_TYPE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:paymentMethod;
    rr:objectMap [
      rr:template "http://vocab.gtfs.org/terms#{PAY}";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:transfers;
    rr:objectMap [
      rr:template "http://vocab.gtfs.org/terms#{TRANS}";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:transferExpiryTime;
    rr:objectMap [
      rr:datatype xsd:duration;
      rr:column "TRANSFER_DURATION";
    ];
  ];
.


<TriplesMapService>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "CALENDAR"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/service/{SERVICE_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:Service;
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:monday;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "MONDAY";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:tuesday;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "TUESDAY";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:wednesday;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "WEDNESDAY";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:thursday;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "THURSDAY";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:friday;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "FRIDAY";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:saturday;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "SATURDAY";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:sunday;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "SUNDAY";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate schema:startDate;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "START_DATE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate schema:endDate;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "END_DATE";
    ];
  ];
.  


<TriplesMapFeed>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "FEED_INFO"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:constant "http://linkedgtfs.com/CITY/feed";
    rr:termType rr:IRI;
    rr:class gtfs:Feed;
  ];


  rr:predicateObjectMap[
    rr:predicate dct:publisher;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "FEED_PUBLISHER_NAME";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate foaf:page;
    rr:objectMap [
      rr:datatype foaf:Document;
      rr:column "FEED_PUBLISHER_URL";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate dct:language;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "FEED_LANG";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate schema:startDate;
    rr:objectMap [
      rr:datatype dct:date;
      rr:column "FEED_START_DATE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate schema:endDate;
    rr:objectMap [
      rr:datatype dct:date;
      rr:column "FEED_END_DATE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate schema:version;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "FEED_VERSION";
    ];
  ];

. 


<TriplesMapShape>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "SHAPES"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/shape/{SHAPE_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:Shape;
  ];

  rr:predicateObjectMap[
    rr:predicate geo:lat;
    rr:objectMap [
      rr:datatype xsd:decimal;
      rr:column "SHAPE_PT_LAT";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate geo:long;
    rr:objectMap [
      rr:datatype xsd:decimal;
      rr:column "SHAPE_PT_LON";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:pointSequence;
    rr:objectMap [
      rr:datatype xsd:nonNegativeInteger;
      rr:column "SHAPE_PT_SEQUENCE";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:distanceTraveled;
    rr:objectMap [
      rr:datatype xsd:decimal;
      rr:column "SHAPE_DIST_TRAVELED";
    ];
  ];
.



<TriplesMapFareRule>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "FARE_RULES"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/farerules/{FARE_ID}-{ROUTE_ID}";
    rr:termType rr:IRI;
    rr:class gtfs:FareRule;
  ];


  rr:predicateObjectMap[
    rr:predicate gtfs:fare;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapFare>;
      rr:joinCondition [
        rr:child "FARE_ID";
        rr:parent "FARE_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:route;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapRoute>;
      rr:joinCondition [
        rr:child "ROUTE_ID";
        rr:parent "ROUTE_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:originZone;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "ORIGIN_ID";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:destinationZone;
    rr:objectMap [
      rr:datatype xsd:string;
      rr:column "DESTINATION_ID";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:zone;
    rr:objectMap [
      rr:datatype gtfs:Zone;
      rr:column "CONTAINS_ID";
    ];
  ];
.



<TriplesMapFrequency>
  # a rr:TriplesMap;

  rr:logicalTable [
      rr:tableName "FREQUENCIES"
  ];

  rr:subjectMap [
    a rr:Subject;
    rr:template "http://linkedgtfs.com/CITY/frequency/{TRIP_ID}-{START_TIME}";
    rr:termType rr:IRI;
    rr:class gtfs:Frequency;
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:trip;
    rr:objectMap [
      rr:parentTriplesMap <TriplesMapTrip>;
      rr:joinCondition [
        rr:child "TRIP_ID";
        rr:parent "TRIP_ID";
      ]
    ]
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:startTime;
    rr:objectMap [
      rr:datatype xsd:duration;
      rr:column "START_TIME";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:endTime;
    rr:objectMap [
      rr:datatype xsd:duration;
      rr:column "END_TIME";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:headwaySeconds;
    rr:objectMap [
      rr:datatype xsd:duration;
      rr:column "HEADWAY_SECS";
    ];
  ];

  rr:predicateObjectMap[
    rr:predicate gtfs:exactTimes;
    rr:objectMap [
      rr:datatype xsd:boolean;
      rr:column "EXACT_TIMES";
    ];
  ];

.
